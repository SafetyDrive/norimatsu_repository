import csv
import serial
import time

if __name__ == "__main__":
    ser = serial.Serial("COM4", 9600, timeout=1)

    # CSV????????????
    with open('output.csv', mode='w', newline='') as file:
        writer = csv.writer(file)
        
        # ?????????????????1, ?????2, ?????3, ???
        writer.writerow(['Sensor Value 1', 'Sensor Value 2', 'Sensor Value 3', 'Timestamp'])
        
        # ??????????
        try:
            while True:
                if ser.in_waiting:  # ?????????????????????
                    line = ser.readline().decode('utf-8').strip()  # ????????????
                    values = line.split(' ')  # ??????
                    if len(values) == 3:  # ????3?????????????????
                        timestamp = time.strftime('%Y-%m-%d %H:%M:%S')  # ????????
                        print(f"{timestamp}: {values}")  # ????????????
                        
                        # CSV?????????????
                        writer.writerow([values[0], values[1], values[2], timestamp])
        except Exception as e:
            print(f"??????????: {e}")
        finally:
            # ????????????????????
            print("???????????")
            ser.close()
